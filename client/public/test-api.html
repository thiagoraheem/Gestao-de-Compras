<!DOCTYPE html>
<html>
<head>
    <title>Test API Response</title>
</head>
<body>
    <h1>Teste da API de Purchase Requests</h1>
    <button onclick="testAPI()">Testar API</button>
    <div id="results"></div>

    <script>
        async function testAPI() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Carregando...</p>';
            
            try {
                const response = await fetch('/api/purchase-requests');
                const data = await response.json();
                
                console.log('üìä Resposta completa da API:', data);
                
                // Filtrar as solicita√ß√µes espec√≠ficas
                const sol330 = data.find(r => r.requestNumber === 'SOL-2025-330');
                const sol329 = data.find(r => r.requestNumber === 'SOL-2025-329');
                
                let html = `<h2>Total de solicita√ß√µes: ${data.length}</h2>`;
                
                if (sol330) {
                    html += `
                        <h3>SOL-2025-330:</h3>
                        <ul>
                            <li>ID: ${sol330.id}</li>
                            <li>Current Phase: ${sol330.currentPhase}</li>
                            <li>Category: ${sol330.category}</li>
                            <li>Urgency: ${sol330.urgency}</li>
                        </ul>
                    `;
                } else {
                    html += '<h3>SOL-2025-330: ‚ùå N√£o encontrada</h3>';
                }
                
                if (sol329) {
                    html += `
                        <h3>SOL-2025-329:</h3>
                        <ul>
                            <li>ID: ${sol329.id}</li>
                            <li>Current Phase: ${sol329.currentPhase}</li>
                            <li>Category: ${sol329.category}</li>
                            <li>Urgency: ${sol329.urgency}</li>
                        </ul>
                    `;
                } else {
                    html += '<h3>SOL-2025-329: ‚ùå N√£o encontrada</h3>';
                }
                
                // Mostrar todas em aprovacao_a1
                const aprovacaoA1 = data.filter(r => r.currentPhase === 'aprovacao_a1');
                html += `<h3>Solicita√ß√µes em aprovacao_a1 (${aprovacaoA1.length}):</h3><ul>`;
                aprovacaoA1.forEach(req => {
                    html += `<li>${req.requestNumber}: ${req.currentPhase} (${req.category}, ${req.urgency})</li>`;
                });
                html += '</ul>';
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                console.error('‚ùå Erro ao testar API:', error);
                resultsDiv.innerHTML = `<p style="color: red;">Erro: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
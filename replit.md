# Kanban Purchase Management System

## Overview

This is a full-stack web application for managing purchase requests using a Kanban-style workflow. The system allows users to create, track, and manage purchase requests through various phases from initial request to completion. The application is designed to support both human users and AI agents for automated processing.

## System Architecture

### Frontend Architecture
- **Framework**: React 18 with TypeScript
- **Build Tool**: Vite for fast development and optimized builds
- **UI Library**: Shadcn/ui components built on Radix UI primitives
- **Styling**: Tailwind CSS with CSS variables for theming
- **State Management**: TanStack Query for server state management
- **Routing**: Wouter for lightweight client-side routing
- **Form Handling**: React Hook Form with Zod validation

### Backend Architecture
- **Runtime**: Node.js with TypeScript
- **Framework**: Express.js for API server
- **Database**: PostgreSQL with Drizzle ORM
- **Database Provider**: Neon serverless PostgreSQL
- **Session Management**: Session storage table prepared for future authentication
- **API Style**: RESTful endpoints with JSON responses

### Data Storage Solutions
- **Primary Database**: PostgreSQL hosted on Neon
- **ORM**: Drizzle ORM with TypeScript-first schema definitions
- **Migrations**: Drizzle Kit for database schema migrations
- **Connection**: WebSocket-enabled connection pool for serverless compatibility

## Key Components

### Purchase Request Workflow
The system implements a fixed 8-phase Kanban workflow:
1. **Solicitação** (Request) - Initial request creation
2. **Aprovação A1** (Approval A1) - First level approval
3. **Cotação** (RFQ) - Request for quotation
4. **Aprovação A2** (Approval A2) - Second level approval
5. **Pedido de Compra** (Purchase Order) - Official purchase order
6. **Conclusão de Compra** (Purchase Completion) - Purchase finalization
7. **Recebimento** (Receipt) - Material receipt
8. **Arquivado** (Archived) - Completed and archived

### User Management System
- Role-based access control with buyer, approver A1, and approver A2 roles
- Department-based organization with cost center associations
- User authentication prepared for JWT implementation
- Password hashing with bcryptjs

### Data Models
Key entities include:
- **Users**: Authentication and role management
- **Departments**: Organizational structure
- **Cost Centers**: Budget allocation tracking
- **Suppliers**: Vendor management
- **Purchase Requests**: Core workflow entities
- **Attachments**: File upload support
- **Payment Methods**: Payment processing options

## Data Flow

### Request Lifecycle
1. User creates purchase request with required information
2. Request enters approval workflow based on configured rules
3. Approvers can approve, reject, or request modifications
4. Buyers handle quotation and supplier selection
5. Final approval triggers purchase order creation
6. Material receipt completes the workflow

### API Integration
- RESTful endpoints for all CRUD operations
- Standardized JSON responses for AI agent compatibility
- Query-based data fetching with TanStack Query
- Form validation using Zod schemas shared between client and server

## External Dependencies

### Core Dependencies
- **@neondatabase/serverless**: Database connectivity
- **drizzle-orm**: Type-safe database queries
- **@tanstack/react-query**: Server state management
- **@radix-ui/**: Accessible UI component primitives
- **tailwindcss**: Utility-first CSS framework
- **wouter**: Minimalist routing library

### Development Dependencies
- **vite**: Fast build tool and dev server
- **typescript**: Type safety across the stack
- **tsx**: TypeScript execution for development
- **esbuild**: Fast JavaScript bundler for production

## Deployment Strategy

### Development Environment
- Vite dev server with hot module replacement
- TypeScript compilation with strict mode enabled
- Database migrations using Drizzle Kit
- Environment variable configuration for database connection

### Production Build
- Vite builds optimized client bundle
- esbuild creates serverless-compatible server bundle
- Static assets served from Express server
- Database connection uses connection pooling for scalability

### Environment Configuration
- `DATABASE_URL` environment variable required for PostgreSQL connection
- Separate build processes for client and server code
- Production deployment uses Node.js server with built assets

## Changelog
- July 15, 2025. Correção crítica do menu de navegação - opção "Fornecedores" liberada para usuários compradores:
  - ✓ Identificado problema onde "Fornecedores" estava restrito apenas a administradores na navegação
  - ✓ Movido "Fornecedores" de adminNavigation para baseNavigation no PipefyHeader
  - ✓ Agora todos os usuários (incluindo compradores) podem acessar a tela de fornecedores
  - ✓ Correção alinhada com a proteção AdminOrBuyerRoute da página de fornecedores
  - ✓ Sistema de navegação agora consistente com permissões funcionais
- July 15, 2025. Campo de Empresa liberado para todos os usuários nas solicitações implementado com sucesso:
  - ✓ Campo "Empresa" na criação de nova solicitação agora disponível para todos os usuários, não apenas administradores
  - ✓ Removida restrição `!!user?.isAdmin` das queries de empresas em new-request-modal.tsx e enhanced-new-request-modal.tsx
  - ✓ Atualizado schema do new-request-modal para incluir validação obrigatória do campo companyId
  - ✓ Campo empresa incluído na tela de edição de solicitações para todos os usuários (edit-request-modal.tsx)
  - ✓ Todos os usuários podem agora selecionar qualquer empresa cadastrada ao criar ou editar solicitações
  - ✓ Mantida funcionalidade de pré-seleção da empresa do usuário como padrão quando disponível
- July 14, 2025. Sistema de armazenamento de logos em base64 no banco de dados implementado com sucesso:
  - ✓ Migração completa de armazenamento de logos de arquivos para base64 no banco de dados
  - ✓ Campo logoBase64 adicionado à tabela companies em substituição ao logoUrl
  - ✓ Componente LogoUpload atualizado para converter arquivos para base64 e enviar via JSON
  - ✓ API endpoint atualizado para receber e validar logos em base64 (5MB máximo)
  - ✓ Validação de formato (PNG, JPG, JPEG) e tamanho mantidas no frontend e backend
  - ✓ Serviço de PDF atualizado para usar logos base64 diretamente sem conversão
  - ✓ Interface de empresas atualizada para exibir logos base64 corretamente
  - ✓ Removida configuração multer para upload de arquivos de logo
  - ✓ Removida rota de servir arquivos de logo (/uploads/company_logos)
  - ✓ Sistema mais eficiente para PDFs com logos embutidos diretamente no HTML
  - ✓ Migração de dados existente executada com sucesso
- July 14, 2025. Sistema de empresa dinâmico no PDF do Pedido de Compra implementado com sucesso:
  - ✓ Dados da empresa agora carregados do banco de dados através do usuário solicitante
  - ✓ Campo companyId do usuário usado para buscar informações da empresa cadastrada
  - ✓ Header do PDF reformulado com logo da empresa à esquerda e informações centralizadas
  - ✓ Logo convertida para base64 para garantir exibição tanto na pré-visualização quanto no PDF final
  - ✓ Informações dinâmicas: nome da empresa, endereço, CNPJ, telefone e email
  - ✓ Removidas informações hardcoded da "BLOMAQ" substituídas por dados dinâmicos
  - ✓ Layout responsivo com flexbox para logo e informações da empresa
  - ✓ Sistema robusto de fallback quando empresa não tem logo cadastrada
- July 14, 2025. PDF do Pedido de Compra reformulado com assinaturas eletrônicas implementado com sucesso:
  - ✓ Removido quadro "Histórico de Aprovações" do PDF do Pedido de Compra
  - ✓ Criado seção "ASSINADO ELETRONICAMENTE POR:" com layout profissional
  - ✓ Implementado grid de assinaturas eletrônicas com dois quadros lado a lado
  - ✓ Adicionadas informações de Solicitante (Comprador) e Liberador com datas e horários
  - ✓ Layout seguindo template fornecido pelo usuário com bordas e formatação adequada
  - ✓ Sistema de datas automáticas baseado nos timestamps reais de criação e aprovação
- July 14, 2025. Sistema de gestão aprimorado com filtros e layout unificado implementado com sucesso:
  - ✓ Adicionado filtro "Mostrar empresas inativas" na tela de Empresas para reativação
  - ✓ Criado botão "Ativar" para empresas inativas com confirmação de segurança
  - ✓ Migrado layout da tela Locais de Entrega de tabela para cards (igual às Empresas)
  - ✓ Implementado filtro "Mostrar locais inativos" na tela de Locais de Entrega
  - ✓ Adicionada funcionalidade ativar/desativar para locais de entrega
  - ✓ Padronizado layout de cards entre Empresas e Locais de Entrega para consistência visual
  - ✓ Melhorado tratamento de erros com mensagens específicas em português
  - ✓ Sistema de permissões mantido (apenas administradores podem gerenciar)
  - ✓ Interface responsiva com badges de status e ícones visuais consistentes
- July 14, 2025. Sistema de restrição de aprovação A1 por centro de custo implementado com sucesso:
  - ✓ Criado middleware canApproveRequest para validar permissões de centro de custo no backend
  - ✓ Aplicado middleware na rota POST /api/purchase-requests/:id/approve-a1
  - ✓ Criado endpoint GET /api/purchase-requests/:id/can-approve-a1 para verificação de permissões
  - ✓ Adicionada validação de centro de custo na movimentação via drag-and-drop no Kanban
  - ✓ Modificado sistema de notificações por e-mail para enviar apenas para aprovadores dos centros corretos
  - ✓ Atualizado componente ApprovalA1Phase com query para verificar permissões específicas
  - ✓ Implementado alerta visual diferenciado para usuários sem permissão de aprovação A1
  - ✓ Adicionada filtragem automática no KanbanBoard para mostrar apenas solicitações dos centros associados
  - ✓ Query para centros de custo do usuário habilitada apenas para aprovadores A1
  - ✓ Sistema agora garante que aprovadores só vejam e possam aprovar solicitações dos seus centros
  - ✓ Segurança aprimorada com validações tanto no frontend (UX) quanto no backend (segurança)
- July 14, 2025. Correção crítica dos botões de aprovação A1 implementada com sucesso:
  - ✓ Identificado problema onde botões "Aprovar" e "Reprovar" na fase A1 não funcionavam
  - ✓ Corrigido formato de chamada da API de apiRequest("POST", url, data) para apiRequest(url, { method: "POST", body: data })
  - ✓ Adicionado parsing correto da resposta JSON com response.json()
  - ✓ Botões de aprovação A1 agora movem corretamente o card para próxima fase
  - ✓ Corrigido também componente supplier-creation-modal com mesmo problema de API
  - ✓ Sistema de aprovação A1 totalmente funcional
- July 14, 2025. Correção crítica do PDF de Conclusão de Pedido com dados completos e histórico correto implementada com sucesso:
  - ✓ Corrigidos dados incorretos no "Histórico de Aprovações" - agora usa timeline completo do processo
  - ✓ Departamento e centro de custo agora buscados corretamente das entidades relacionadas
  - ✓ Fornecedor vencedor incluído com todos os dados da cotação selecionada
  - ✓ Valores dos itens baseados nos preços reais da cotação vencedora
  - ✓ Timeline traduzida para português: "Solicitação", "Aprovação A1", "Cotação (RFQ)", etc.
  - ✓ Datas corrigidas para usar campo timestamp em vez de date undefined
  - ✓ Adicionada seção "Dados da Cotação Vencedora" com valor, prazo e condições
  - ✓ Justificativa da escolha do fornecedor incluída quando disponível
  - ✓ Sistema robusto de busca de dados com fallback para casos sem cotação
- July 14, 2025. Funcionalidade de impressão aprimorada na tela Conclusão de Compra implementada com sucesso:
  - ✓ Substituído window.print() por abertura de nova janela para impressão
  - ✓ Criado sistema generatePrintableHTML() com conteúdo completo e formatação profissional
  - ✓ HTML otimizado para impressão com estilos CSS dedicados (@media print)
  - ✓ Nova janela inclui todos os dados: métricas, resumo, fornecedor, itens e timeline
  - ✓ Solução resolve problema de modal/frame bloqueando conteúdo na impressão
  - ✓ Impressão agora captura todo o conteúdo da tela de conclusão
- July 14, 2025. Organização dos locais de entrega por ID na criação de RFQ implementada com sucesso:
  - ✓ Dropdown "Local de Entrega" na tela "Criar Solicitação de Cotação" agora ordenado por ID crescente
  - ✓ Aplicado .sort((a, b) => a.id - b.id) antes do mapeamento dos locais de entrega
  - ✓ Melhoria na experiência do usuário com ordem consistente e previsível
  - ✓ Migração do Replit Agent para Replit finalizada com sucesso
- July 14, 2025. Correção crítica do erro de JSON parsing na atualização de permissões de usuário implementada com sucesso:
  - ✓ Identificado erro "Unexpected token '<', '<!DOCTYPE'..." ao tentar atualizar permissões de usuário
  - ✓ Problema estava no formato incorreto da função apiRequest no frontend
  - ✓ Corrigido de apiRequest(method, endpoint, data) para apiRequest(endpoint, {method, body})
  - ✓ Atualizado createUserMutation, checkDeleteUserMutation e deleteUserMutation
  - ✓ Sistema de edição de usuários agora funciona sem erros de parsing JSON
  - ✓ Modal "Editar Usuário" permite atualizar permissões corretamente
  - ✓ Todas as operações CRUD de usuários funcionando adequadamente
- July 14, 2025. Sistema completo de timeline na fase de Conclusão implementado com sucesso:
  - ✓ Criado componente ProcessTimeline para visualização completa do histórico
  - ✓ Implementado endpoint /api/purchase-requests/:id/complete-timeline no backend
  - ✓ Método getCompleteTimeline adicionado ao storage para buscar dados completos
  - ✓ Timeline mostra todas as 8 fases do workflow com ícones visuais e status
  - ✓ Informações incluem usuários, timestamps, descrições e motivos de rejeição
  - ✓ Componente reutilizável integrado à tela de Conclusão de Compra
  - ✓ Melhor visualização do processo completo para auditoria e acompanhamento
- July 13, 2025. Correção crítica do botão "Avançar para Recebimento" e finalização do sistema de badge A2 implementada com sucesso:
  - ✓ Corrigido botão "Avançar para Recebimento" na fase Pedido de Compra que não respondia ao clique
  - ✓ Problema estava no formato da chamada apiRequest - corrigido de apiRequest("POST", url) para apiRequest(url, {method: "POST"})
  - ✓ Botão agora funciona corretamente com confirmação e avanço para fase de Recebimento
  - ✓ Corrigido problema de renderização do badge "Nec.Cotação" causado por warning do React ref
  - ✓ Substituído componente Badge por div customizado para evitar conflitos de referência
  - ✓ Sistema de badge funcionando corretamente - aparece apenas quando request está em fase "cotacao" E foi reprovado em A2 com ação "recotacao"
  - ✓ Removido debug logging após confirmação do funcionamento correto
  - ✓ Aplicação totalmente funcional com todos os fluxos de aprovação e movimentação operacionais
- July 13, 2025. Correção crítica do badge de reprovação A2 na fase de cotação implementada com sucesso:
  - ✓ Identificado problema onde badge "Nec.Cotação" não aparecia após reprovação A2 com opção "retornar para cotação"
  - ✓ Corrigido método getAllPurchaseRequests() no storage.ts para incluir campos approvedA2, rejectionReasonA2 e rejectionActionA2
  - ✓ Campos estavam definidos no schema mas não sendo selecionados pela query da API
  - ✓ Removidos logs de erro desnecessários do console na verificação de status de cotação
  - ✓ Badge agora aparece corretamente quando request.approvedA2 === false e request.rejectionActionA2 === "recotacao"
  - ✓ Migração do Replit Agent para Replit finalizada com sucesso
  - ✓ Aplicação funcionando corretamente com todas as funcionalidades operacionais
- July 12, 2025. Correção crítica do sistema de aprovação A2 - botão de rejeição aprimorado com modal de opções:
  - ✓ Corrigido botão "Rejeitar" da fase A2 para abrir modal de aprovação em vez de rejeitar diretamente
  - ✓ Implementado parâmetro initialAction para pré-selecionar opção de rejeição no modal
  - ✓ Adicionado estado de controle para distinguir entre cliques de aprovar e rejeitar
  - ✓ Corrigida mensagem de sucesso para mostrar destino correto baseado na ação de rejeição
  - ✓ Melhorado formato da requisição API para consistência com outros componentes
  - ✓ Adicionado logging para debug do processo de aprovação A2
  - ✓ Sistema agora permite escolher entre "Arquivar definitivamente" ou "Retornar para nova cotação"
  - ✓ Aplicação funcionando corretamente com feedback visual adequado
- July 12, 2025. Migração completa do Replit Agent para Replit com suporte a múltiplas RFQs e melhorias A2 implementada com sucesso:
  - ✓ Migração bem-sucedida do projeto para ambiente Replit
  - ✓ Adicionados campos de banco de dados para suporte a múltiplas RFQs (isActive, rfqVersion, parentQuotationId)
  - ✓ Implementado sistema de versionamento de RFQs com desativação automática de versões anteriores
  - ✓ Criado componente de histórico de RFQs com visualização de todas as versões
  - ✓ Adicionados botões "Nova RFQ" e "Histórico" na fase de cotação
  - ✓ Implementada API para recuperação de histórico de RFQs por solicitação
  - ✓ Melhorias na fase de Aprovação A2 com opções de rejeição (arquivar ou retornar para cotação)
  - ✓ Sistema de controle de versão permite criar novas cotações mantendo histórico anterior
  - ✓ Aplicação funcionando corretamente no ambiente Replit com todas as funcionalidades preservadas
- July 11, 2025. Correção crítica do sistema de envio para aprovação na tela de edição de solicitação implementada com sucesso:
  - ✓ Identificado problema onde tela de "Editar Solicitação" não movia cards para fase "Aprovação A1"
  - ✓ Corrigido sendToApprovalMutation em request-phase.tsx com optimistic updates
  - ✓ Adicionado sistema de cache invalidation abrangente para garantir sincronização UI-backend
  - ✓ Implementado rollback automático em caso de erro na operação
  - ✓ Melhorado feedback visual imediato com atualização otimista do estado
  - ✓ Corrigido sendToApprovalMutation em purchase-card.tsx com as mesmas melhorias
  - ✓ Sistema de envio para aprovação agora funciona corretamente tanto no card quanto na tela de edição
- July 11, 2025. Migração completa do Replit Agent para Replit finalizada com correção do sistema de criação de locais de entrega:
  - ✓ Migração bem-sucedida do projeto para ambiente Replit
  - ✓ Corrigido erro crítico na função apiRequest do queryClient.ts
  - ✓ Ajustada ordem de parâmetros: apiRequest(url, { method, body }) em vez de apiRequest(method, url, data)
  - ✓ Melhoradas mensagens de erro para criação de locais de entrega em português
  - ✓ Adicionado tratamento específico para violações de constraint única (nomes duplicados)
  - ✓ Sistema de locais de entrega agora funciona corretamente para criação e edição
  - ✓ Aplicação rodando estável na porta 5000 com PostgreSQL operacional
  - ✓ Todos os componentes e APIs respondendo adequadamente
- July 11, 2025. Correção crítica de exibição de dados de fornecedores na tela "Pedido de Compra" implementada com sucesso:
  - ✓ Identificado problema onde API de cotações de fornecedores retornava dados incompletos
  - ✓ Corrigida query getSupplierQuotations no storage.ts para incluir todos os campos de fornecedor
  - ✓ Adicionados campos phone, cnpj, contact, address e paymentTerms na consulta de fornecedores
  - ✓ Corrigido formulário de cadastro de fornecedores para incluir campo telefone
  - ✓ Atualizada tabela de exibição de fornecedores para mostrar telefone
  - ✓ Campo telefone agora exibe valores reais (92992002858) em vez de "Não informado"
  - ✓ Campos CNPJ e condições de pagamento agora exibem dados corretos na tela Pedido de Compra
  - ✓ Migração do Replit Agent para Replit finalizada com todas as funcionalidades preservadas
  - ✓ Corrigido problema de persistência do campo "Observações do Pedido de Compra"
  - ✓ Adicionada rota PATCH para atualizações parciais de purchase requests
  - ✓ Implementado useEffect para recarregar dados do formulário após salvamento bem-sucedido
  - ✓ Observações do Pedido de Compra agora aparecem na fase de Recebimento de Material
  - ✓ Seção dedicada com destaque visual azul para observações na tela de recebimento
- July 11, 2025. Correção crítica do sistema de upload de arquivos para fornecedores implementada com sucesso:
  - ✓ Corrigido problema crítico no endpoint /api/quotations/:id/upload-supplier-file que retornava "Nenhum arquivo foi enviado"
  - ✓ Corrigida função apiRequest no queryClient para lidar corretamente com FormData (não definir Content-Type)
  - ✓ Adicionados logs detalhados no backend para debug de uploads
  - ✓ Implementada validação robusta de arquivos no frontend (tipo e tamanho)
  - ✓ Melhorado tratamento de erros com mensagens específicas para o usuário
  - ✓ Garantida validação de limite de 10MB e tipos de arquivo permitidos
  - ✓ Sistema de upload de arquivos de cotação agora funciona corretamente
- July 11, 2025. Migração completa do Replit Agent para Replit e correção crítica do sistema de PDF do Pedido de Compra:
  - ✓ Migração bem-sucedida do projeto para ambiente Replit com todas as funcionalidades preservadas
  - ✓ Corrigido campo "Solicitante" no PDF - agora exibe nome completo do solicitante da requisição
  - ✓ Corrigido campo "Prazo de Entrega" para usar prazo negociado com fornecedor selecionado
  - ✓ Confirmada busca correta das "Condições de Pagamento" da cotação do fornecedor
  - ✓ Removidas colunas desnecessárias "DESCONTO" e "VALOR FINAL" da tabela do PDF
  - ✓ Adicionada coluna "MARCA" para melhor identificação dos itens
  - ✓ Layout do PDF limpo e profissional com todas as informações corretas
  - ✓ Aplicação funcionando corretamente na porta 5000 com PostgreSQL
  - ✓ Sistema de autenticação e APIs respondendo adequadamente
- July 11, 2025. Correção crítica do sistema de upload de arquivos na cotação de fornecedores e PDF do Pedido de Compra:
  - ✓ Migração completa do projeto para ambiente Replit sem erros
  - ✓ Corrigido warning do React Fragment que gerava logs de erro no console
  - ✓ Implementado sistema completo de exibição de pendências em cards de Pedido de Compra
  - ✓ Badge vermelha "Pendência" exibida quando solicitação retorna do Recebimento com problema
  - ✓ Tooltip no badge de pendência mostra a mensagem completa ao passar o mouse
  - ✓ Área dedicada na tela de detalhes do Pedido de Compra para mostrar motivo da pendência
  - ✓ Campos has_pendency e pendency_reason corretamente mapeados da API
  - ✓ Corrigido sistema de geração de PDF do Pedido de Compra:
    - ✓ Departamento agora busca corretamente através do relacionamento cost center → department
    - ✓ Prazo de entrega corrigido para usar idealDeliveryDate formatado em dd/mm/aaaa
    - ✓ Condição de pagamento busca primeiro da cotação do fornecedor, depois do fornecedor
    - ✓ Removido campo "Transportadora" do PDF conforme solicitado
  - ✓ Tela de Conclusão aprimorada com correções solicitadas:
    - ✓ Removido quadro "Economia" da exibição de métricas
    - ✓ Corrigido dados do solicitante e centro de custo com busca das entidades relacionadas
    - ✓ Implementado sistema de exibição de todos os anexos disponíveis (solicitação + cotações)
    - ✓ Anexos organizados por tipo: "Anexos da Solicitação" e "Anexos de Cotações"
    - ✓ Rota API criada para buscar anexos de cotações de fornecedores
  - ✓ Sistema funcionando corretamente na porta 5000 sem erros de aplicação
  - ✓ Banco de dados PostgreSQL operacional com todas as funcionalidades preservadas
- July 11, 2025. Correção crítica do sistema de upload de arquivos na cotação de fornecedores implementada com sucesso:
  - ✓ Identificado problema onde upload de arquivos na cotação mostrava sucesso mas falha não era detectada
  - ✓ Rota backend não estava configurada corretamente para receber arquivos via multer
  - ✓ Criada configuração quotationUpload com multer para arquivos de cotação de fornecedores
  - ✓ Corrigida rota /api/quotations/:id/upload-supplier-file para usar multer.single('file')
  - ✓ Implementado filtro de tipos de arquivo (PDF, DOC, DOCX, XLS, XLSX, TXT, PNG, JPG)
  - ✓ Definido limite de 10MB para uploads de arquivos
  - ✓ Melhorada notificação de sucesso para ser precisa - diferencia entre sucesso total e parcial
  - ✓ Upload agora salva arquivos na pasta uploads/supplier_quotations com nomes únicos
  - ✓ Sistema de upload de fornecedores agora funciona corretamente
- July 11, 2025. Remoção completa do sistema de anexos de solicitação original implementada com sucesso:
  - ✓ Identificado e removido completamente o sistema de upload de anexos na criação de solicitações
  - ✓ Removidas queries de anexos dos componentes approval-a1-phase.tsx e approval-a2-phase.tsx
  - ✓ Removidas seções AttachmentsViewer das telas de aprovação A1 e A2
  - ✓ Removidas rotas backend GET/POST /api/purchase-requests/:id/attachments
  - ✓ Removida configuração multer específica para uploads de purchase requests
  - ✓ Limpeza do banco de dados - removido 1 registro órfão de attachment
  - ✓ Sistema de anexos de fornecedores mantido intacto e funcionando
  - ✓ Sistema de anexos de cotações mantido intacto e funcionando
  - ✓ Componente AttachmentsViewer preservado para outros tipos de anexos
  - ✓ Migração da Replit Agent para Replit finalizada com sucesso
  - ✓ Aplicação funcionando corretamente com todas as funcionalidades preservadas

## Changelog
- July 10, 2025. Correção crítica na rotina de limpeza de dados - ordem das exclusões ajustada:
  - ✓ Identificado problema de constraint de chave estrangeira na limpeza de dados
  - ✓ Corrigida ordem de exclusão: attachments agora são deletados antes das supplier_quotations
  - ✓ Tabela attachments possui referência para supplier_quotation_id que causava erro FK
  - ✓ Sistema de limpeza agora funciona corretamente respeitando todas as constraints
  - ✓ Ordem correta: receipt_items → receipts → purchase_order_items → purchase_orders → supplier_quotation_items → attachments → supplier_quotations → quotation_items → quotations → approval_history → purchase_request_suppliers → purchase_request_items → purchase_requests
- July 10, 2025. Personalização do remetente de e-mails RFQ implementada com sucesso:
  - ✓ Campo "De" dos e-mails para fornecedores agora usa o e-mail do usuário logado no sistema
  - ✓ Função sendRFQToSuppliers atualizada para aceitar parâmetro senderEmail opcional
  - ✓ Sistema obtém automaticamente o e-mail do usuário da sessão ativa
  - ✓ Fallback para e-mail padrão do sistema caso usuário não tenha e-mail cadastrado
  - ✓ Fornecedores agora recebem e-mails diretamente do comprador responsável pela cotação
- July 10, 2025. CORREÇÃO CRÍTICA: Problema de carregamento de especificações técnicas na criação de RFQ solucionado:
  - ✓ Identificado problema de race condition onde especificações técnicas não apareciam no primeiro carregamento
  - ✓ Implementado sistema robusto de loading states para aguardar carregamento completo dos dados
  - ✓ Adicionado indicador visual de carregamento enquanto dados são buscados do servidor
  - ✓ Melhorada lógica de população de campos do formulário com state management adequado
  - ✓ Form trigger implementado para garantir sincronização correta de todos os campos
  - ✓ Especificações técnicas agora carregam corretamente na primeira abertura da tela
  - ✓ Sistema de migração do Replit Agent para Replit finalizado com sucesso
- July 10, 2025. CORREÇÃO CRÍTICA DE SEGURANÇA: Sistema de sessões de usuário implementado com PostgreSQL:
  - ✓ Identificado problema crítico onde usuários compartilhavam sessões entre computadores diferentes
  - ✓ Implementado PostgreSQL como store de sessões em vez de memória compartilhada
  - ✓ Adicionada biblioteca connect-pg-simple para gerenciamento seguro de sessões
  - ✓ Cada computador/navegador agora tem sessão isolada e independente
  - ✓ Configurado sameSite: 'lax' para proteção contra CSRF
  - ✓ Implementado rolling sessions para renovar expiração com atividade
  - ✓ Criação automática da tabela 'session' no PostgreSQL
  - ✓ Sistema de segurança agora funciona corretamente - logins independentes por dispositivo
- July 10, 2025. Migração bem-sucedida do Replit Agent para Replit implementada com sucesso:
  - ✓ Migração completa do projeto para ambiente Replit
  - ✓ CORREÇÃO FINAL da mensagem de aprovação A1 - problema com drag-and-drop resolvido
  - ✓ Toast de aprovação agora usa variables.approved em vez de selectedAction
  - ✓ Sistema funciona corretamente tanto para aprovação manual quanto por drag-and-drop
  - ✓ Sistema de aprovação A1 agora exibe "Solicitação aprovada e movida para Cotação!" corretamente
  - ✓ Aplicação funcionando corretamente na porta 5000 com Express + Vite
  - ✓ Banco de dados PostgreSQL operacional com todas as funcionalidades
  - ✓ Sistema de autenticação e APIs respondendo adequadamente
  - ✓ Todas as dependências instaladas e configuradas corretamente
  - ✓ Workflow "Start application" funcionando com hot-reload
  - ✓ Interface React servindo corretamente com componentes shadcn/ui
  - ✓ Sistema Kanban totalmente operacional com todas as fases do processo
- July 10, 2025. Correção crítica no sistema de recuperação de senha - problema de importação corrigido:
  - ✓ Identificado erro "gt is not defined" na validação de tokens de recuperação
  - ✓ Corrigido import faltante da função 'gt' do drizzle-orm no arquivo storage.ts
  - ✓ Sistema de validação de tokens agora funciona corretamente
  - ✓ URLs de recuperação de senha agora validam tokens adequadamente
  - ✓ Testado fluxo completo: geração → validação → redefinição de senha
- July 10, 2025. Sistema completo de recuperação de senha implementado e integrado à tela de login:
  - ✓ Campos password_reset_token e password_reset_expires adicionados à tabela users
  - ✓ Página "Esqueceu sua senha?" criada com formulário de e-mail para recuperação
  - ✓ Página de redefinição de senha com validação de token segura
  - ✓ Sistema de tokens seguros com expiração de 1 hora para segurança
  - ✓ APIs completas: /api/auth/forgot-password, /api/auth/validate-reset-token, /api/auth/reset-password
  - ✓ Serviço de e-mail integrado com templates profissionais para recuperação
  - ✓ Link "Esqueceu sua senha?" funcional na tela de login direcionando para recuperação
  - ✓ Rotas públicas configuradas no App.tsx para páginas de recuperação
  - ✓ Validação de formulários com feedback visual e tratamento de erros
  - ✓ Sistema totalmente funcional e integrado ao fluxo de autenticação existente
- July 10, 2025. Funcionalidades completas de edição e exclusão implementadas em módulos administrativos:
  - ✓ Sistema de edição para departamentos e centros de custo com pré-preenchimento de formulários
  - ✓ Validação e verificação de segurança para exclusão de usuários
  - ✓ Modal de confirmação com detalhes dos itens associados antes da exclusão
  - ✓ Botões de editar e excluir integrados nas tabelas de usuários
  - ✓ Títulos dinâmicos nos modais ("Novo" vs "Editar") baseados no contexto
  - ✓ Funções de fechamento corretas para todos os modais com reset de estado
  - ✓ Atualizações otimistas e invalidação abrangente de cache
  - ✓ Mensagens de toast de sucesso/erro em português brasileiro
  - ✓ Consistência com padrões existentes (React Query, Zod validation, shadcn/ui)
- July 10, 2025. Correção crítica do sistema de atualizações instantâneas com otimizações avançadas implementada com sucesso:
  - ✓ Implementadas atualizações otimistas (optimistic updates) em todas as telas de cadastro
  - ✓ Cache invalidation agressivo com staleTime reduzido para 0 (dados imediatamente obsoletos)
  - ✓ Sistema de rollback automático em caso de erro nas mutações
  - ✓ Invalidação forçada e refetch imediato após todas as operações CRUD
  - ✓ Usuários, departamentos, fornecedores e solicitações agora aparecem instantaneamente
  - ✓ Eliminada necessidade de F5 ou CTRL+F5 para ver dados atualizados
  - ✓ Feedback visual imediato com toast notifications de sucesso/erro
  - ✓ Sistema robusto de detecção e correção de falhas nas atualizações
- July 10, 2025. Otimização crítica do sistema de cache para eliminar atrasos na atualização de dados implementada com sucesso:
  - ✓ Reduzido staleTime global do React Query de Infinity para 2 segundos para feedback em tempo real
  - ✓ Habilitado refetchOnWindowFocus e refetchOnMount para melhor responsividade
  - ✓ Implementado invalidação abrangente de cache em todas as mutações críticas
  - ✓ Adicionado refetchQueries forçado após operações de criação/atualização
  - ✓ Implementadas atualizações otimistas (optimistic updates) no Kanban para feedback visual imediato
  - ✓ Melhorado sistema de invalidação por predicados para capturar todas as queries relacionadas
  - ✓ Reduzido intervalo de refetch no Kanban de 10s para 3s para maior responsividade
  - ✓ Adicionada invalidação cruzada entre usuários, departamentos e centros de custo
  - ✓ Sistema agora reflete mudanças imediatamente sem necessidade de F5 ou espera
- July 10, 2025. Filtro de centros de custo por usuário na criação de solicitações implementado com sucesso:
  - ✓ Modal de nova solicitação agora filtra centros de custo pelos associados ao usuário logado
  - ✓ Modal aprimorado de nova solicitação também implementado com filtro de centros de custo
  - ✓ Correção do campo requesterId para usar o usuário autenticado em vez de valor hardcoded
  - ✓ Integração com hook useAuth para obter dados do usuário atual
  - ✓ Sistema de segurança melhorado evitando associações incorretas de centros de custo
- July 9, 2025. Correção do sistema de geração de PDF com fallback robusto implementada com sucesso:
  - ✓ Identificado problema de dependências faltantes do Chromium no ambiente Replit
  - ✓ Implementado sistema de fallback que retorna HTML quando PDF falha
  - ✓ Usuário pode usar Ctrl+P (Cmd+P no Mac) para imprimir ou salvar como PDF
  - ✓ Fallback HTML contém instruções claras para o usuário
  - ✓ Sistema detecta automaticamente se retornou PDF real ou HTML de fallback
  - ✓ Geração de PDF agora é tolerante a falhas de dependências do sistema
- July 9, 2025. Correção crítica do cálculo de valores totais na atualização de cotação implementada com sucesso:
  - ✓ Identificado problema na função parseNumberFromCurrency que não processava corretamente valores brasileiros
  - ✓ Corrigido parsing de valores formatados como "2.500,00" (separador de milhares + decimal)
  - ✓ Implementado tratamento específico para formato brasileiro (ponto = milhares, vírgula = decimal)
  - ✓ Adicionado suporte para formatos "1000,50" e "2.500,00" simultaneamente
  - ✓ Cálculo de valor total agora exibe corretamente R$ 5.360,00 em vez de R$ 365,00
  - ✓ Valores individuais por item também corrigidos na interface de cotação
- July 9, 2025. Correção crítica das mensagens de status de aprovação implementada com sucesso:
  - ✓ Identificado problema onde mensagens de aprovação mostravam texto incorreto
  - ✓ Corrigido approval-a1-phase.tsx: mensagem de aprovação agora mostra "Solicitação aprovada e movida para Cotação!"
  - ✓ Padronizado título das mensagens de sucesso entre A1 e A2 para "Sucesso"
  - ✓ Mantida mensagem correta para reprovações: "Solicitação reprovada e movida para Arquivado"
  - ✓ Aprovações A1 e A2 agora exibem feedback de status correto para os usuários
- July 9, 2025. Correção crítica do erro "data is not defined" no sistema de criação de RFQ implementada com sucesso:
  - ✓ Identificado problema no callback onSuccess da mutação RFQ onde tentava acessar `data.purchaseRequestId`
  - ✓ Corrigido erro de escopo - `data` não estava disponível no callback onSuccess
  - ✓ Substituído `data.purchaseRequestId` por `purchaseRequest.id` que está disponível no escopo do componente
  - ✓ Corrigidas todas as invalidações de cache para usar o ID correto da solicitação de compra
  - ✓ Erro "data is not defined" totalmente resolvido - usuários podem criar RFQs sem erros JavaScript
  - ✓ Sistema de cache invalidation funcionando corretamente após criação de RFQ
- July 9, 2025. Correção crítica do erro de foreign key constraint no sistema de criação de cotação implementada com sucesso:
  - ✓ Identificado problema onde RFQ creation tentava usar createdBy = 1 (usuário inexistente)
  - ✓ Corrigido sistema de autenticação para usar ID do usuário da sessão (ID 3) em vez de valor hardcoded
  - ✓ Atualizada validação do servidor para usar userId da sessão de forma segura
  - ✓ Removida dependência do frontend de fornecer createdBy - agora é definido pelo servidor
  - ✓ Teste bem-sucedido de criação de cotação com ID de usuário autenticado
  - ✓ Sistema de segurança melhorado - server-side validation com dados de sessão
- July 9, 2025. Migração completa do Replit Agent para Replit implementada com sucesso (migração finalizada):
  - ✓ Configuração do banco de dados PostgreSQL com 22 tabelas criadas manualmente
  - ✓ Correção de todos os erros de schema incluindo colunas ausentes (approver_a1_id, approver_a2_id, etc.)
  - ✓ Aplicação funcionando corretamente na porta 5000 sem erros
  - ✓ Todas as dependências instaladas e configuradas adequadamente
  - ✓ Sistema de autenticação e APIs respondendo corretamente
  - ✓ Frontend servindo interface React com Vite corretamente
  - ✓ Banco de dados completamente operacional com todas as tabelas necessárias
- July 8, 2025. Migração completa do Replit Agent para Replit implementada com sucesso (migração finalizada):
  - ✓ Corrigido erro crítico de sintaxe no PDF service que impedia build de produção
  - ✓ Removido código duplicado e estruturas try/catch malformadas
  - ✓ Sistema de build agora funciona corretamente com npm run build
  - ✓ Aplicação totalmente funcional no ambiente Replit com Express + Vite
  - ✓ Banco de dados PostgreSQL configurado e inicializado
  - ✓ Autenticação funcionando corretamente
  - ✓ Sistema Kanban operacional com todas as fases do processo de compra
  - ✓ APIs respondendo adequadamente para frontend e backend
  - ✓ Corrigido problema crítico dos valores zerados no PDF do pedido de compra
  - ✓ Mapeamento correto entre itens da solicitação e cotações do fornecedor selecionado
  - ✓ PDF agora mostra valores reais: R$ 150,00 (Placa mãe) e R$ 100,00 (Memoria ram)
  - ✓ Correção da lógica de busca por fornecedor escolhido (isChosen = true)
  - ✓ Campos de marca e prazo de entrega corretamente preenchidos no PDF
  - ✓ Tela de recebimento aprimorada com tabela completa de itens incluindo valores e dados do fornecedor
  - ✓ Tela de Aprovação A2 aprimorada com dados completos do fornecedor vencedor
  - ✓ Exibição em formato de tabela dos itens com valores unitários e totais na aprovação A2
  - ✓ Informações detalhadas do fornecedor: nome, email, telefone, CNPJ, condições de pagamento
  - ✓ Justificativa da escolha do fornecedor exibida em ambas as telas (aprovação e recebimento)
  - ✓ Corrigido problema na tela de Recebimento de Material onde informações do fornecedor apareciam como N/A
  - ✓ Tela de Recebimento agora exibe dados corretos do fornecedor selecionado igual à tela de Conclusão
- July 8, 2025. Correção crítica do erro de PDF em produção - sistema robusto de geração de PDF implementado:
  - ✓ Identificado erro "TargetCloseError: Protocol error (Page.printToPDF): Target closed"
  - ✓ Implementado sistema robusto de lançamento de browser com retry e fallback
  - ✓ Adicionados timeouts adequados para todas as operações PDF (30 segundos)
  - ✓ Melhorada gestão de recursos com fechamento adequado de páginas e browsers
  - ✓ Implementadas 3 configurações de fallback para lançamento do browser
  - ✓ Adicionado sistema de retry progressivo com delays entre tentativas
  - ✓ Logs detalhados para debugging de problemas em produção
  - ✓ Tratamento de erros robusto para evitar travamentos na geração de PDF
  - ✓ Aplicado para todos os tipos de PDF: pedido de compra, dashboard e resumo de conclusão
  - ✓ Configurações específicas para ambientes com recursos limitados
- July 8, 2025. Correção crítica do erro de produção - arquivo PRODUCTION_DEPLOYMENT.md criado:
  - ✓ Identificado problema: aplicação rodando em produção sem build adequado
  - ✓ Erro "ENOENT: no such file or directory, open 'C:\Locador\client\index.html'" resolvido
  - ✓ Criado guia completo de deploy para produção (PRODUCTION_DEPLOYMENT.md)
  - ✓ Documentados comandos necessários: npm run build antes de npm start
  - ✓ Explicado diferença entre desenvolvimento (npm run dev) e produção (npm start)
  - ✓ Listadas variáveis de ambiente necessárias para produção
  - ✓ Estrutura de arquivos após build documentada
  - ✓ Guia de troubleshooting para erros comuns de produção
- July 8, 2025. Tela de Pedido de Compra aprimorada com dados reais do fornecedor vencedor:
  - ✓ Corrigida lógica de seleção do fornecedor vencedor (isChosen = true)
  - ✓ Implementada tabela organizada para exibição de itens com valores reais
  - ✓ Adicionado quadro completo com informações do fornecedor vencedor
  - ✓ Exibição correta de valores unitários, totais, marcas e prazos
  - ✓ Valores agora mostram R$ 150,00 (Placa mãe) e R$ 100,00 (Memória) em vez de R$ 0,00
  - ✓ Seção "Fornecedor Vencedor" com dados completos: nome, email, telefone, CNPJ
  - ✓ Informações da proposta: valor total, prazo de entrega, condições de pagamento
  - ✓ Interface responsiva e profissional para visualização de dados do pedido
  - ✓ Integração correta com supplier_quotation_items para buscar preços reais
  - ✓ Fallback para casos onde dados do fornecedor não estão disponíveis
- July 8, 2025. Sistema de comparação de fornecedores aprimorado para permitir seleção parcial:
  - ✓ Corrigida lógica de comparação para permitir seleção quando pelo menos um fornecedor respondeu
  - ✓ Removido requisito de que TODOS os fornecedores precisam responder antes da comparação
  - ✓ Melhorada condição `canCompareSuppliers` na quotation-phase.tsx
  - ✓ Atualizada lógica em purchase-card.tsx para distinguir entre "sem respostas" e "algumas respostas"
  - ✓ Sistema agora permite comparação e seleção mesmo quando alguns fornecedores marcam "não respondeu"
  - ✓ Mantida funcionalidade de alert sobre fornecedores que não responderam
  - ✓ Comparação filtra automaticamente apenas fornecedores que responderam
  - ✓ Processo de cotação mais flexível e alinhado com realidade do mercado
- July 8, 2025. Calendário de seleção de data implementado mantendo máscara brasileira:
  - ✓ Adicionado ícone de calendário no lado direito dos campos DateInput
  - ✓ Calendário visual integrado usando Popover e Calendar do shadcn/ui
  - ✓ Mantida funcionalidade de digitação manual com máscara DD/MM/AAAA
  - ✓ Localização em português brasileiro (ptBR) para o calendário
  - ✓ Conversão automática entre seleção visual e formato brasileiro
  - ✓ Ambos os métodos (digitação e calendário) funcionam simultaneamente
  - ✓ Validação de data mantida para ambos os inputs
  - ✓ Interface intuitiva com ícone de calendário sempre visível
- July 8, 2025. Correção crítica da fase de conclusão - linha do tempo e valores dos itens implementada com sucesso:
  - ✓ Corrigido problema de valores zerados nos itens da fase de conclusão
  - ✓ Implementado carregamento correto de itens de cotação do fornecedor selecionado
  - ✓ Corrigido mapeamento entre itens de solicitação e itens de cotação por descrição
  - ✓ Melhorado cálculo de valores totais baseado nos preços do fornecedor escolhido
  - ✓ Corrigida linha do tempo para mostrar informações completas das fases
  - ✓ Adicionado suporte a labels de fase em português (PHASE_LABELS)
  - ✓ Melhorado display de aprovadores com nomes completos
  - ✓ Implementado status visual diferenciado para aprovações e rejeições
  - ✓ Adicionado tratamento para histórico vazio com mensagem informativa
  - ✓ Corrigido estado de loading para incluir carregamento de itens de cotação
  - ✓ Valores agora exibem corretamente R$ 200,00 em vez de R$ 0,00
  - ✓ Timeline mostra fases como "Aprovação A1", "Cotação (RFQ)" etc. em vez de valores vazios
- July 8, 2025. Máscara de data brasileira implementada em todos os campos de data:
  - ✓ Criado componente DateInput com formatação brasileira DD/MM/AAAA
  - ✓ Substituído input type="date" por DateInput customizado em todos os formulários
  - ✓ Atualizado modal de nova solicitação com máscara de data brasileira
  - ✓ Atualizado modal de nova solicitação aprimorado com máscara de data brasileira
  - ✓ Atualizado modal de edição para campos de data de entrega e prazo ideal
  - ✓ Atualizado formulário de criação de RFQ para prazo de cotação e entrega de itens
  - ✓ Implementada conversão automática entre formato de exibição (DD/MM/AAAA) e formato ISO para banco
  - ✓ Adicionada validação de data para garantir datas válidas
  - ✓ Campos de data agora seguem padrão brasileiro como solicitado pelo usuário
- July 8, 2025. Migração completa do Replit Agent para ambiente Replit realizada com sucesso:
  - ✓ Verificação de pacotes instalados e dependências
  - ✓ Confirmação de funcionamento da aplicação no ambiente Replit
  - ✓ Banco de dados PostgreSQL inicializado com dados padrão
  - ✓ Servidor Express rodando corretamente na porta 5000
  - ✓ Interface React funcionando com hot-reload
  - ✓ Sistema de autenticação operacional
  - ✓ Todos os endpoints da API respondendo adequadamente
- July 8, 2025. Correção crítica dos valores zerados na fase Pedido de Compra e sistema de PDF implementada com sucesso e erro de geração de PDF corrigido:
  - ✓ Corrigido problema de valores zerados nos itens da fase Pedido de Compra
  - ✓ Implementado sistema de combinação de itens com preços do fornecedor selecionado
  - ✓ Corrigido cálculo de valores totais baseado nos preços dos itens do fornecedor
  - ✓ Adicionada query para buscar itens do fornecedor selecionado com preços unitários
  - ✓ Melhorado display de informações incluindo marca e tempo de entrega
  - ✓ Corrigido sistema de geração de PDF com configuração adequada do Chromium
  - ✓ Instalado chromium como dependência do sistema e configurado path correto
  - ✓ Implementado sistema de fallback para geração de PDF em caso de falha
  - ✓ Aplicado correções tanto para PDF do dashboard quanto para pedido de compra
  - ✓ Valores agora são exibidos corretamente nos cards e PDFs gerados
  - ✓ Corrigido erro "unitPrice.toFixed is not a function" tanto na interface quanto no PDF service
  - ✓ Implementado verificação de tipo adequada para valores numéricos
  - ✓ Corrigido mapeamento entre itens de solicitação e cotação usando descrições
  - ✓ Aplicado Number() conversion para garantir cálculos corretos de subtotal
  - ✓ PDF e interface agora mostram valores R$ 200,00 corretamente para cada item
- July 8, 2025. Correção crítica do erro de database query em send-to-approval implementada com sucesso:
  - ✓ Corrigido erro "Cannot convert undefined or null to object" no getPurchaseRequestById
  - ✓ Refatorado método para usar queries separadas em vez de JOINs complexos do Drizzle
  - ✓ Melhorado tratamento de dados de usuário nulos/indefinidos
  - ✓ Sistema de envio para aprovação A1 totalmente funcional
  - ✓ Erro que impedia movimentação de cards para aprovação resolvido
  - ✓ Migração completa para ambiente Replit finalizada com sucesso
- July 8, 2025. Remoção do campo "Orçamento Disponível" e seção de anexos da RFQ implementada com sucesso:
  - ✓ Removido campo "availableBudget" de todos os formulários de criação de solicitação
  - ✓ Campo removido de new-request-modal.tsx, enhanced-new-request-modal.tsx e edit-request-modal.tsx
  - ✓ Campo mantido no schema do banco para retrocompatibilidade mas tornado opcional na interface
  - ✓ Removida completamente a seção de upload de anexos da criação de RFQ (rfq-creation.tsx)
  - ✓ Removido estado attachments, funções handleFileUpload e removeAttachment
  - ✓ Removido import Upload e Card de anexos da tela de criação de RFQ
  - ✓ Mantidos apenas anexos da solicitação original para visualização
  - ✓ Interface mais limpa e focada nas informações essenciais da cotação
- July 7, 2025. Correção crítica das rotas de status de cotação e eliminação de erros "Invalid quotation ID":
  - ✓ Corrigida rota incorreta `/api/quotations/by-request/${id}` para `/api/quotations/purchase-request/${id}` em kanban-board.tsx
  - ✓ Melhorada query key do status de cotação para usar formato ['quotation-status', requestId] em purchase-card.tsx
  - ✓ Adicionado tratamento de erro robusto que retorna status padrão em vez de gerar exceções
  - ✓ Configurado staleTime de 5 segundos e retry de 2 tentativas para melhor performance
  - ✓ Eliminados logs de erro "Invalid quotation ID" que apareciam no console
  - ✓ Sistemas de verificação de status de cotação agora funcionam sem erros
  - ✓ Interface visual mantém indicadores corretos: vermelho, laranja e verde conforme status
  - ✓ Todos os cards na fase "Cotação (RFQ)" exibem status correto sem causar erros de rede
- July 7, 2025. Correção crítica dos problemas de cache e atualização em tempo real implementada com sucesso:
  - ✓ Corrigidos problemas de demora na atualização de informações após criação de RFQ
  - ✓ Melhorada invalidação abrangente de cache em todas as mutações críticas
  - ✓ Corrigido erro de quotation ID indefinido que causava chamadas para rotas inexistentes
  - ✓ Eliminadas chamadas para /api/quotations/undefined/supplier-quotations
  - ✓ Adicionado refetch automático para componentes críticos (5-10 segundos)
  - ✓ Cache invalidation com predicados para limpeza abrangente de queries relacionadas
  - ✓ Melhorado feedback visual imediato após operações de criação e movimentação
  - ✓ Sistema de cache mais responsivo com staleTime otimizado
  - ✓ Interface agora reflete mudanças imediatamente sem necessidade de F5
- July 7, 2025. Correção dos filtros de Departamento e Urgência do Kanban implementada com sucesso:
  - ✓ Filtro de Departamento corrigido para usar request.department.id em vez de request.departmentId
  - ✓ Filtro de Urgência corrigido para usar valores corretos: "alto", "medio", "baixo"
  - ✓ Ambos os filtros (mobile e desktop) atualizados com valores consistentes
  - ✓ Filtros agora funcionam corretamente em vez de fazer todos os itens sumirem
- July 7, 2025. Melhoria na tela de comparação de fornecedores implementada com sucesso:
  - ✓ Substituída exibição de "Item #" por descrições reais dos itens na comparação detalhada
  - ✓ Adicionada consulta aos itens da cotação para obter descrições completas
  - ✓ Atualizada tanto a tabela de comparação quanto os cards dos fornecedores
  - ✓ Interface mais intuitiva mostrando "Colheres" em vez de "Item #20"
  - ✓ Mantido fallback para casos onde a descrição não está disponível
- July 7, 2025. Correção crítica do status de cotação nos cards do Kanban implementada com sucesso:
  - ✓ Corrigida rota de verificação de status de cotação de `/api/quotations/by-request/${id}/status` (inexistente) para `/api/quotations/purchase-request/${id}` (existente)
  - ✓ Melhorado tratamento de erros para evitar mensagens de "Erro ao verificar status"
  - ✓ Adicionada validação para cotações inexistentes com status "Nenhuma cotação criada"
  - ✓ Verificação aprimorada do status de cotações de fornecedores (received vs pending)
  - ✓ Indicadores visuais diferenciados para status de erro, carregamento e diferentes fases
  - ✓ Sistema de retry configurado para melhor reliability
  - ✓ Status específicos: "Nenhuma cotação criada", "Aguardando cotações", "Aguardando seleção", "Pronto para A2"
  - ✓ Eliminadas chamadas para rotas inexistentes que causavam erros 400
- July 7, 2025. Validações de progressão de fase e botão de avanço implementados com sucesso:
  - ✓ Validação obrigatória para progressão Cotação → Aprovação A2
  - ✓ Verificação automática de cotação completa com fornecedor selecionado
  - ✓ Bloqueio de movimentação sem análise finalizada e fornecedor vencedor escolhido
  - ✓ Botão "Avançar para Recebimento" implementado na fase Pedido de Compra
  - ✓ Funcionalidade de avanço disponível no card do Kanban e no modal PurchaseOrderPhase
  - ✓ Confirmação obrigatória antes de mover para fase Recebimento
  - ✓ Indicadores visuais de status em cards da fase Cotação
  - ✓ Status "Pronto para Aprovação A2" vs "Aguardando seleção de fornecedor"
  - ✓ API endpoint /api/purchase-requests/:id/advance-to-receipt implementado
  - ✓ Validações de segurança no backend para progressões de fase
  - ✓ Mensagens de erro específicas e descritivas para validações falhadas
  - ✓ Integração completa com sistema de notificações e histórico
  - ✓ Interface responsiva com feedback visual em tempo real
- July 7, 2025. Sistema de controle de permissões rigoroso implementado com sucesso:
  - ✓ Controle de permissões por perfil para movimentação de cards no Kanban
  - ✓ Cards na fase "Aprovação A1" só podem ser movidos por usuários com isApproverA1: true
  - ✓ Cards na fase "Aprovação A2" só podem ser movidos por usuários com isApproverA2: true
  - ✓ Aprovação automática por movimentação implementada no backend
  - ✓ Movimento A1→Cotação registra automaticamente aprovação A1 com histórico
  - ✓ Movimento A2→Pedido de Compra registra automaticamente aprovação A2 com histórico
  - ✓ Visualização restrita com modal informativo para usuários sem permissão
  - ✓ Modais A1/A2 mostram dados completos em modo somente leitura quando sem permissão
  - ✓ Feedback visual: cards não arrastáveis têm cursor "not-allowed" e opacidade reduzida
  - ✓ Validações de segurança no frontend (UX) e backend (segurança)
  - ✓ Mensagens de erro específicas para tentativas de movimentação não autorizadas
  - ✓ Drag handles desabilitados com tooltip explicativo para cards sem permissão
  - ✓ Alertas visuais em cards restritos indicando permissão necessária
  - ✓ Sistema mantém experiência fluida para usuários com permissões adequadas
- July 7, 2025. Dashboard Executivo implementado com sucesso:
  - ✓ Criado Dashboard page com KPIs executivos e análises completas
  - ✓ Implementado sistema de permissões (isManager) para acesso ao dashboard
  - ✓ Adicionado campo isManager à tabela de usuários via schema
  - ✓ Criado ManagerRoute component para controle de acesso
  - ✓ Dashboard integrado ao header principal com ícone BarChart3
  - ✓ API endpoint /api/dashboard com cálculos de métricas executivas
  - ✓ Gráficos interativos: departamentos, urgência, tendências mensais, funil de conversão
  - ✓ Filtros funcionais por período, departamento e status
  - ✓ Tabelas de top departamentos, fornecedores e solicitações atrasadas
  - ✓ Funcionalidade de exportação em PDF implementada
  - ✓ Serviço PDF com template executivo profissional
  - ✓ Endpoint /api/dashboard/export-pdf para download de relatórios
  - ✓ Interface responsiva com design moderno usando Recharts
  - ✓ Métricas de performance: tempo médio de aprovação, taxa de aprovação
  - ✓ Sistema de cores baseado em status (verde, amarelo, vermelho)
  - ✓ Navegação contextual baseada em roles (managers + admins)
- July 7, 2025. Componente ConclusionPhase implementado com funcionalidade completa:
  - ✓ Criado componente React ConclusionPhase para fase "Conclusão de Compra"
  - ✓ Resumo completo da solicitação com dados do solicitante, departamento e centro de custo
  - ✓ Visualização detalhada do fornecedor selecionado com dados de contato
  - ✓ Exibição de dados do pedido de compra e informações de recebimento
  - ✓ Timeline visual do processo com histórico de aprovações
  - ✓ Lista detalhada de itens recebidos com status e valores
  - ✓ Cards de métricas (tempo total, valor, economia, status)
  - ✓ Funcionalidades de exportação PDF, impressão e envio por e-mail
  - ✓ Sistema de arquivamento com observações finais
  - ✓ Visualizador de anexos do processo
  - ✓ Interface responsiva seguindo padrões do projeto
  - ✓ Integração completa com sistema de modais do Kanban
  - ✓ API endpoints para arquivamento, PDF e notificação por e-mail
  - ✓ Componente autossuficiente com visão 360° do processo de compra
- July 7, 2025. Sistema de notificações por e-mail com URLs configuráveis e autenticação com redirecionamento:
  - ✓ URLs de acesso configuráveis através do arquivo config.ts usando BASE_URL
  - ✓ Detecção automática do domínio Replit via REPLIT_DOMAINS
  - ✓ Links diretos para solicitações específicas nos e-mails (/kanban?request=ID&phase=FASE)
  - ✓ Sistema de redirecionamento pós-login para URLs de acesso direto via e-mail
  - ✓ Armazenamento de URL de destino no sessionStorage quando usuário não autenticado
  - ✓ Abertura automática de solicitações específicas via parâmetros de URL
  - ✓ Configuração centralizada de e-mail usando config.ts em vez de variáveis espalhadas
  - ✓ Links específicos para cada fase: Ver Solicitação, Revisar e Aprovar A1, Revisar e Aprovar A2
  - ✓ Arquivo .env.example com documentação das variáveis de ambiente necessárias
- July 7, 2025. Migração para Replit e melhorias na interface:
  - ✓ Migração bem-sucedida do projeto para ambiente Replit
  - ✓ Correção do layout dos botões na fase de recebimento (responsivo e melhor ajuste)
  - ✓ Implementação de filtro por período de data no kanban
  - ✓ Filtro de data padrão para o mês atual e aplicado especificamente a itens arquivados
  - ✓ Layout responsivo para filtros tanto em mobile quanto desktop
  - ✓ Conexão com banco PostgreSQL configurada adequadamente
  - ✓ Sistema totalmente funcional no ambiente Replit
  - ✓ Criação da tela detalhada de recebimento com informações completas da solicitação
  - ✓ Exibição de solicitante, aprovadores, itens de compra e fornecedor selecionado na fase de recebimento
  - ✓ Botões de confirmação e pendência integrados na interface de recebimento
  - ✓ Refatoração completa da tela de atualização de cotação com valores por item
  - ✓ Implementação de cálculo automático do valor total baseado nos itens
  - ✓ Interface para upload de arquivos de proposta dos fornecedores
  - ✓ Comparação detalhada entre fornecedores com visualização de todos os itens e valores
  - ✓ Tabela de comparação item por item mostrando preços unitários, totais, prazos e marcas
  - ✓ Correção do campo de valor monetário para permitir digitação natural sem formatação automática
  - ✓ Aplicação do filtro de período para fase Conclusão (igual à fase Arquivado)
  - ✓ Estilo acinzentado aplicado nas fases finais (Conclusão e Arquivado) seguindo padrão Pipefy
  - ✓ Remoção do botão "Arquivar" da fase Conclusão por ser uma fase final
- July 7, 2025. Correção do nome do solicitante na tela de cotação:
  - ✓ Corrigido método getPurchaseRequestById para incluir dados do usuário solicitante
  - ✓ Simplificada consulta SQL para evitar erros com JOINs complexos
  - ✓ Corrigido componente QuotationPhase para acessar dados do requester corretamente
  - ✓ Nome do solicitante agora aparece corretamente na interface de gestão de cotações
  - ✓ Suporte tanto para request.requesterName quanto request.requester.firstName/lastName
- July 7, 2025. Correção de problemas críticos na tela de Atualizar Cotação:
  - ✓ Corrigido problema de valores incorretos (1000 → R$ 1,00 em vez de R$ 1.000,00)
  - ✓ Melhorada lógica de formatação de valores monetários para entrada natural
  - ✓ Corrigida condição para mostrar botão "Comparar e Selecionar Fornecedor"
  - ✓ Botão agora aparece quando TODOS os fornecedores responderam (não apenas alguns)
  - ✓ Sistema de valores monetários totalmente funcional e consistente
- July 7, 2025. Sistema de notificações por e-mail implementado:
  - ✓ Notificações automáticas para compradores quando nova solicitação é criada
  - ✓ Notificações para aprovadores A1 quando solicitação entra na fase de aprovação A1
  - ✓ Notificações para aprovadores A2 quando solicitação entra na fase de aprovação A2
  - ✓ Templates de e-mail responsivos com detalhes completos da solicitação
  - ✓ Sistema assíncrono para evitar bloqueio do workflow principal
  - ✓ Filtros por roles (isBuyer, isApproverA1, isApproverA2) para envio direcionado
  - ✓ Configuração via variáveis de ambiente (SMTP_HOST, SMTP_USER, SMTP_PASS, FROM_EMAIL)
  - ✓ Integração com criação de solicitações e transições de fase via Kanban
- July 6, 2025. Sistema de geração de PDF do Pedido de Compra implementado:
  - ✓ Criado serviço de geração de PDF baseado no template Excel fornecido (PDFService)
  - ✓ Implementado componente PurchaseOrderPhase com resumo completo do processo
  - ✓ Adicionado botão de download de PDF na fase Pedido de Compra
  - ✓ Rota API /api/purchase-requests/:id/pdf para gerar e baixar PDFs
  - ✓ Interface mostra histórico de aprovações, fornecedor selecionado e todos os dados relevantes
  - ✓ PDF segue estrutura do template da empresa com dados dinâmicos da solicitação
- July 6, 2025. Correções de interface mobile e implementação de filtros funcionais:
  - ✓ Corrigido posicionamento do menu hambúrguer em dispositivos móveis (agora totalmente visível)
  - ✓ Melhorado layout responsivo do header com flexbox otimizado
  - ✓ Implementado sistema de filtros funcionais no kanban (departamento e urgência)
  - ✓ Filtros carregam dados reais do banco (departamentos) e aplicam filtros em tempo real
  - ✓ Layout mobile do kanban aprimorado com títulos e filtros verticais
  - ✓ Adicionado scrollbar customizado para melhor experiência no kanban
- July 6, 2025. Migração para Replit e correções críticas:
  - ✓ Migração bem-sucedida do projeto para ambiente Replit
  - ✓ Correção da contagem incorreta de anexos nos cards do kanban (substituído Math.random por busca real de dados)
  - ✓ Implementação de menu responsivo para dispositivos móveis no header principal
  - ✓ Menu hambúrguer funcional com navegação completa para mobile
  - ✓ Mapeamento correto de campos decimal do banco para interface (requestedQuantity)
  - ✓ Sistema de anexos totalmente funcional nos cards do kanban
- July 6, 2025. Correção crítica no sistema de aprovação (dados incorretos):
  - ✓ Corrigido bug grave onde a tela de aprovação exibia itens de TODAS as solicitações em vez de apenas a específica
  - ✓ Problema estava nas query keys do React Query usando arrays multi-elemento incorretamente
  - ✓ Corrigido query keys para usar URLs completas: `/api/purchase-requests/${id}/items`
  - ✓ Aplicado fix nas fases de aprovação A1 e A2 para garantir dados corretos
  - ✓ Sistema agora exibe apenas os itens da solicitação específica sendo aprovada
- July 6, 2025. Melhorias na interface e funcionalidade do Kanban:
  - ✓ Removido botão global "+" de criação de RFQ da tela principal
  - ✓ Adicionado botão "Criar RFQ" dentro dos cards da fase de cotação (apenas quando não há RFQ criada)
  - ✓ Campo "Solicitante" incluído em todos os cards do Kanban
  - ✓ Campo "Aprovador" incluído nos cards a partir da fase de cotação
  - ✓ Interface mais limpa e contextual para criação de RFQs
- July 6, 2025. Correção do sistema de comparação de fornecedores:
  - ✓ Corrigido problema que exibia valores zerados na tela de comparação
  - ✓ Sistema agora usa o valor total armazenado na base de dados
  - ✓ Valores corretos são exibidos (R$ 1.500,00 e R$ 9.999,10)
  - ✓ Removido campo de especificações técnicas da tela de criação de RFQ
  - ✓ Comparação de fornecedores totalmente funcional
- July 4, 2025. Sistema de comparação e seleção de fornecedores implementado:
  - ✓ Corrigidas rotas duplicadas que causavam exibição incorreta de anexos e histórico
  - ✓ Sistema completo de comparação de fornecedores na fase de cotação
  - ✓ Interface para seleção de fornecedor vencedor com justificativa
  - ✓ Validação que impede avanço da fase de cotação sem seleção de fornecedor
  - ✓ Componente SupplierComparison com visualização detalhada de propostas
  - ✓ Integração com API para persistir seleção e avançar automaticamente para Aprovação A2
  - ✓ Migração completa para ambiente Replit com correção de problemas de relacionamento
- July 4, 2025. Sistema de e-mails e correção da exibição de fornecedores implementado:
  - ✓ Serviço de e-mail integrado com nodemailer para envio automático de RFQs
  - ✓ Correção do método getSupplierQuotations para incluir dados dos fornecedores via JOIN
  - ✓ Funcionalidade de edição de RFQ implementada com carregamento de dados existentes
  - ✓ Modal de edição agora carrega fornecedores previamente selecionados
  - ✓ Interface aprimorada para distinguir entre criação e edição de cotações
  - ✓ Sistema de envio de e-mails com tratamento de erros e feedback ao usuário
- July 4, 2025. Refatoração do sistema de criação de RFQ com carregamento automático de itens:
  - ✓ RFQ agora carrega automaticamente todos os itens da solicitação original
  - ✓ Interface melhorada com distinção visual entre dados originais e campos de cotação
  - ✓ Campos de especificações técnicas e prazos de entrega destacados para preenchimento
  - ✓ Validação e feedback visual aprimorados para facilitar o preenchimento
  - ✓ Migração concluída para ambiente Replit com segurança e melhores práticas
- July 4, 2025. Sistema de aprovação e layout totalmente funcional:
  - ✓ Correção do layout dos cards - títulos em uma linha, botões reorganizados
  - ✓ Sistema de permissões baseado em roles implementado (isApproverA1, isApproverA2, isBuyer)
  - ✓ Fase A2 de aprovação criada com funcionalidade completa
  - ✓ Histórico de aprovações com rastreamento de usuários e timestamps
  - ✓ Visualizador de anexos integrado em todas as fases
  - ✓ Botão de fechamento adicionado na fase de cotação
  - ✓ Modal de edição corrigido para fase A2 - agora mostra interface correta
  - ✓ Validação e persistência de dados aprimoradas
  - ✓ Sistema de aprovação A1 e A2 totalmente operacional
- July 3, 2025. Migração bem-sucedida para Replit e refatoração do layout:
  - Novo layout estilo Pipefy com header fixo e navegação horizontal
  - Kanban full-width sem sidebars, otimizado para visualização das fases
  - Botão flutuante "Nova Solicitação" no canto inferior esquerdo
  - Modal de criação aprimorado com opção de cadastro manual OU upload de planilha
  - Correção de bugs na validação de campos decimais (availableBudget, etc.)
  - Melhoria na edição de itens com correção de problemas de persistência
  - Sistema de validação flexível: itens manuais OU planilha (não ambos obrigatórios)
- July 1, 2025. Implemented comprehensive Kanban phases system including:
  - Request Phase: Complete form with file upload, validation, and visual feedback
  - Approval A1 Phase: Role-based approval with detailed request review and justification
  - Quotation Phase: Multi-supplier quotation management with comparison tools
  - Request Management Page: Unified interface for managing all purchase requests by phase
  - Enhanced API endpoints for approval workflow, quotations, and attachments
- December 30, 2024. Fixed responsive sidebar with hamburger menu functionality for mobile and desktop
- December 30, 2024. Corrected layout issues by removing duplicate headers and fixing content margins
- June 27, 2025. Initial setup

## User Preferences

Preferred communication style: Simple, everyday language.
{
  "meta": {
    "project": "Sistema de Gestão de Compras",
    "date": "2025-09-10",
    "prepared_by": "Software Development Manager"
  },
  "product_overview": "O Sistema de Gestão de Compras é uma aplicação web full-stack que automatiza o fluxo completo de solicitações de compra empresariais, desde a criação até o recebimento, através de um workflow Kanban de 8 fases, garantindo aprovações hierárquicas, cotações competitivas, e rastreabilidade total.",
  "core_goals": [
    "Automatizar e controlar o processo completo de compras empresariais",
    "Garantir validações e aprovações hierárquicas rigorosas com restrição por centro de custo",
    "Facilitar a gestão de fornecedores e cotações múltiplas",
    "Prover rastreabilidade e auditoria completa para compliance",
    "Oferecer interface responsiva, acessível e intuitiva para diversos perfis de usuário",
    "Gerar documentos oficiais como pedidos de compra e relatórios de conclusão em PDF",
    "Enviar notificações automáticas por e-mail em todos os pontos críticos do processo",
    "Permitir multi-empresa, multi-departamento e multi-centro de custo com controle de acesso refinado"
  ],
  "key_features": [
    "Workflow Kanban com 8 fases: Solicitação, Aprovação A1, Cotação (RFQ), Aprovação A2, Pedido de Compra, Conclusão, Recebimento, Arquivado",
    "Controle de acesso baseado em roles: Admin, Manager, Buyer, Approver A1, Approver A2, Receiver",
    "Permissões especiais para gerentes que podem criar solicitações para qualquer centro de custo",
    "Processo de aprovação com validação dupla e justificativa obrigatória para reprovações",
    "Importação de itens via Excel na criação de solicitações",
    "Gestão de cotações com múltiplos fornecedores, upload e comparação de propostas",
    "Geração automática de PDFs para pedidos de compra e relatórios",
    "Sistema de notificações automatizadas via e-mail",
    "Dashboard executivo com métricas e gráficos interativos",
    "Suporte a múltiplas empresas, departamentos e centros de custo",
    "Upload e gestão de documentos e anexos com validação de tipos e tamanhos",
    "Histórico completo de aprovações e alterações",
    "Sistema seguro com autenticação, autorização, proteção CSRF e criptografia de senhas"
  ],
  "user_flow_summary": [
    "Usuário autenticado acessa a aplicação conforme seu perfil de acesso",
    "Solicitante cria nova solicitação preenchendo formulário e podendo importar itens via Excel; gerentes podem escolher qualquer centro de custo, outros usuários ficam restritos",
    "Solicitação é enviada para aprovação A1; aprovadores A1 só podem aprovar solicitações de centros de custo associados, com justificativa obrigatória para reprovação e notificações via e-mail",
    "Após aprovação A1, compradores criam RFQ com múltiplos fornecedores, enviam cotações e recebem propostas para análise",
    "Aprovadores A2 revisam cotações, aprovam ou reprovam com opção de arquivar ou solicitar nova cotação",
    "Compradores geram pedidos de compra em PDF com dados completos e assinam eletronicamente, depois encaminham para recebimento",
    "Recebedores confirmam recebimento, fazem controle de qualidade e podem retornar pedidos com pendências",
    "Processo é concluído, exibindo timeline, métricas e relatórios; itens e documentos ficam arquivados para auditoria"
  ],
  "validation_criteria": [
    "Todas as 8 fases do workflow devem estar implementadas e funcionando corretamente",
    "Permissões e restrições devem ser aplicadas rigorosamente tanto no frontend quanto backend",
    "Formulários apresentam validação clara e feedback em tempo real, inclusive para importação de Excel",
    "Geração de PDFs com layout profissional deve ser correta e conter todas as informações dinâmicas",
    "Notificações por e-mail devem ser enviadas corretamente e assincronamente sem bloquear processos",
    "Histórico completo de aprovações e modificações deve estar disponível",
    "Interface responsiva e acessível, com suporte a navegação por teclado e descrições para componentes de diálogo",
    "Performance adequada com carregamento rápido e respostas REST eficientes",
    "Erros críticos corrigidos, especialmente função ausente na API relacionada a cotações",
    "Upload de arquivos validado quanto a tipo e tamanho, com armazenamento seguro",
    "Segurança implementada com senhas criptografadas, sessões seguras, proteção CSRF e controle de acesso role-based",
    "Documentação técnica e de requisitos atualizada para suportar manutenção e evolução futura"
  ],
  "code_summary": {
    "project_name": "Sistema de Gestão de Compras",
    "description": "Sistema web full-stack para gestão completa de solicitações de compra com workflow Kanban de 8 fases, desde solicitação até recebimento",
    "tech_stack": {
      "frontend": {
        "framework": "React 18",
        "language": "TypeScript",
        "build_tool": "Vite",
        "ui_library": "Shadcn/ui (Radix UI)",
        "styling": "Tailwind CSS",
        "state_management": "TanStack Query",
        "routing": "Wouter",
        "form_handling": "React Hook Form + Zod",
        "drag_drop": "@dnd-kit",
        "charts": "Recharts",
        "icons": "Lucide React"
      },
      "backend": {
        "runtime": "Node.js",
        "language": "TypeScript",
        "framework": "Express.js",
        "database": "PostgreSQL",
        "orm": "Drizzle ORM",
        "validation": "Zod",
        "session_management": "express-session + connect-pg-simple",
        "file_upload": "Multer",
        "pdf_generation": "html-pdf-node + Puppeteer",
        "email": "Nodemailer",
        "authentication": "bcryptjs"
      },
      "database": {
        "type": "PostgreSQL",
        "provider": "Neon Serverless",
        "migration_tool": "Drizzle Kit"
      },
      "deployment": {
        "platform": "Replit",
        "build_system": "Vite + esbuild"
      }
    },
    "architecture": {
      "pattern": "Full-stack monolith with REST API",
      "structure": {
        "client/": "Frontend React application",
        "server/": "Backend Express.js API",
        "shared/": "Shared schemas and types",
        "migrations/": "Database migrations",
        "uploads/": "File storage"
      },
      "api_style": "RESTful endpoints",
      "authentication": "Session-based with PostgreSQL store"
    },
    "core_features": {
      "workflow": {
        "type": "Kanban with 8 fixed phases",
        "phases": [
          "Solicitação",
          "Aprovação A1",
          "Cotação (RFQ)",
          "Aprovação A2",
          "Pedido de Compra",
          "Conclusão",
          "Recebimento",
          "Arquivado"
        ]
      },
      "user_management": {
        "roles": [
          "Admin",
          "Manager",
          "Buyer",
          "Approver A1",
          "Approver A2",
          "Receiver"
        ],
        "permissions": "Role-based access control",
        "multi_company": true,
        "departments": true,
        "cost_centers": true
      },
      "purchase_process": {
        "request_creation": "Form-based with Excel import",
        "approval_workflow": "Two-level approval (A1/A2)",
        "quotation_management": "RFQ with multiple suppliers",
        "purchase_orders": "Automated PDF generation",
        "receipt_tracking": "Material receipt confirmation"
      },
      "supplier_management": {
        "types": [
          "Traditional",
          "Online"
        ],
        "quotation_system": "Multi-supplier comparison",
        "document_upload": "PDF quotations"
      },
      "reporting": {
        "dashboard": "Executive metrics with charts",
        "real_time_data": "Live status tracking",
        "export_formats": [
          "PDF",
          "Excel"
        ]
      }
    },
    "business_rules": {
      "approval_hierarchy": {
        "A1": "Department/Cost center validation",
        "A2": "Final purchase approval"
      },
      "cost_center_restrictions": "Users limited to assigned cost centers (except managers)",
      "manager_privileges": "Can create requests for any cost center",
      "quotation_requirements": "Minimum supplier participation",
      "document_management": "Attachment support for all phases"
    },
    "integrations": {
      "email_notifications": "SMTP-based alerts",
      "erp_integration": "Product data sync (configurable)",
      "file_storage": "Local file system",
      "pdf_generation": "Purchase order automation"
    },
    "database_entities": [
      "companies",
      "users",
      "departments",
      "cost_centers",
      "suppliers",
      "purchase_requests",
      "purchase_request_items",
      "quotations",
      "quotation_items",
      "supplier_quotations",
      "supplier_quotation_items",
      "purchase_orders",
      "purchase_order_items",
      "receipts",
      "receipt_items",
      "attachments",
      "approval_history",
      "payment_methods",
      "delivery_locations"
    ],
    "key_endpoints": {
      "authentication": "/api/auth/*",
      "purchase_requests": "/api/purchase-requests/*",
      "quotations": "/api/quotations/*",
      "suppliers": "/api/suppliers/*",
      "users": "/api/users/*",
      "uploads": "/api/upload/*",
      "reports": "/api/reports/*"
    },
    "testing": {
      "existing_tests": [
        "Complete flow test (test-complete-flow.js)",
        "User validation (check-users.js)",
        "Database debugging scripts"
      ],
      "test_coverage": "Basic integration tests"
    },
    "deployment_config": {
      "environment": "Development/Production",
      "port": 5000,
      "session_store": "PostgreSQL",
      "file_uploads": "Local storage",
      "email_service": "SMTP configurable"
    },
    "project_status": {
      "completion": "75%",
      "production_ready": true,
      "main_features_implemented": true,
      "pending_features": [
        "Advanced reporting",
        "Mobile app",
        "AI integrations",
        "Advanced workflow configuration"
      ]
    }
  }
}
